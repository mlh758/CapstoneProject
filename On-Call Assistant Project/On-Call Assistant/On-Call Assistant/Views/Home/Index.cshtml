@{
    ViewBag.Title = "Home Page";
    ViewBag.AppName = "On-Call Assistant";
}
@section styles {
    <link href="~/Content/fullcalendar.css" rel="stylesheet" />
    <link href="~/Content/fullcalendar.print.css" rel="stylesheet" media='print' />
}

@section scripts {
    <script src="~/Scripts/lib/jquery.min.js"></script>
    <script src="~/Scripts/lib/moment.min.js"></script>
    <script src="~/Scripts/fullcalendar.js"></script>
    <script src="~/Scripts/bootstrap.min.js"></script>
    @*<script type="text/javascript" src="~/Scripts/lib/calendarEvents.js"></script>*@
    <script type="text/javascript">
    $(document).ready(function () {
        $('#calendar').fullCalendar({
            editable: false,
            events: "/home/rotationdata/"});

        $('#GenerateSchedule').click(function (event) {
            event.preventDefault();
            //probably could be refactored...
            window.location.replace("/oncallrotations/generateSchedule");
        });


        @*  Code for sorting rotations on the calendar by app starts here.
            Grab each application and dynamically create a drop-down list item*@
            @foreach(var app in ViewBag.applications)
            {
                @:$("#dropDownList").prepend('<li role="presentation"><a role="menuitem" tabindex="-1" href="#">' + '@app' + '</a></li>');
            }
        $("#dropDownList").prepend('<li role="presentation"><a role="menuitem" tabindex="-1" href="#">Remove Filters</a></li>');
            
        @*Set the onclick event for the the dropdown list items*@
        $('#sortdropdown').on('click', 'ul li a', function () {
            var selectedAppName = $(this).text();
            if (selectedAppName == 'Remove Filters') {
                $('#calendar').fullCalendar('removeEvents');
                $('#calendar').fullCalendar('addEventSource', "/Home/RotationData/" + selectedAppID);
                $('#calendar').fullCalendar('rerenderEvents');
            }
            else {
                var selectedAppID = selectedAppName.slice(selectedAppName.indexOf("-") + 1, selectedAppName.length);
                console.log(selectedAppID);
                $('#calendar').fullCalendar('removeEvents');
                $('#calendar').fullCalendar('addEventSource', "/Home/RotationData?ID=" + selectedAppID);
                $('#calendar').fullCalendar('rerenderEvents');
            }
        });

        @*This part could help in bringing the Filtering button inline with the Today button
            $('.fc-right').prepend('<div class="dropdown" id="sortdropdown"><button type="button" id="menu1" data-toggle="dropdown">Filter By App<span class="caret"></span></button><ul id="dropDownList" class="dropdown-menu"></ul></div>');*@
    });


    </script>





}
<div class="jumbotron">
    <h1>@ViewBag.AppName</h1>
    <p class="lead">Manage your on-call rotations, employees and summaries.</p>
    <p>
        <button id="GenerateSchedule" class="btn btn-primary btn-lg" type="button" onclick='this.disabled = "disabled";'>Generate Schedule</button>

    </p>
    @*Containers for the dropdown list of Application names (for sorting rotations on the calendar by app)*@
    <div class="dropdown" id="sortdropdown">
        <button type="button" id="menu1" data-toggle="dropdown">
            Filter By App
            <span class="caret"></span>
        </button>
        <ul id="dropDownList" class="dropdown-menu"></ul>
    </div>
    <div id="calendar"></div>
   
</div>

